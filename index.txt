<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://unpkg.com/html5-qrcode"></script>
<style>
body { font-family: Arial; background:#eef2f5; padding:10px }
#reader { width:300px; margin:auto }
.card { background:#fff; padding:15px; margin-top:10px; border-radius:8px }
button { width:100%; padding:10px; margin-top:8px }
</style>
</head>

<body>
<h3 align="center">Unified Equipment Scanner</h3>

<div id="reader"></div>
<div id="result" class="card" style="display:none"></div>

<script>
const qr = new Html5Qrcode("reader");

Html5Qrcode.getCameras().then(cams => {
  qr.start(cams[0].id, { fps: 10, qrbox: 250 }, txt => {
    qr.stop();
    google.script.run.withSuccessHandler(showAsset)
      .findAsset(txt.trim());
  });
});

function showAsset(a) {
  if (!a) return alert("Asset not found");
  document.getElementById("result").style.display="block";
  document.getElementById("result").innerHTML = `
    <b>Asset:</b> ${a.Asset_No}<br>
    <b>Dept:</b> ${a.Department}<br>
    <b>Equipment:</b> ${a.Equipment}<br><br>

    <button onclick="openPage('complaint','${a.Asset_No}','${a._sheetId}')">Report Breakdown</button>
    <button onclick="openPage('close','${a.Asset_No}','${a._sheetId}')">Close Breakdown</button>
  `;
}

function openPage(p,a,s){
  window.open(`?page=${p}&asset=${a}&sheet=${s}`,'_blank');
}
</script>
</body>
</html>
