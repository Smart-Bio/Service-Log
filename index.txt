<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hospital Service Request</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #eef2f5;
  margin: 0;
  padding: 15px;
}

.logo { text-align:center; margin-bottom:10px; }
.logo img { max-height:80px; }

h2 { text-align:center; color:#003366; }

#reader { width:100%; max-width:360px; margin:auto; }

.card {
  background:#ffffff;
  border-radius:10px;
  padding:15px;
  margin-top:15px;
  box-shadow:0 2px 8px rgba(0,0,0,0.15);
}

.row {
  display:grid;
  grid-template-columns:120px 10px auto;
  align-items:center;
  margin-bottom:6px;
}

.label { font-weight:bold; }
.colon { text-align:center; }
.value { font-size:14px; }

.btn {
  width:100%;
  padding:12px;
  margin-top:8px;
  border:none;
  border-radius:6px;
  background:#0066cc;
  color:white;
  font-size:15px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="logo">
  <img src="logo.jpg">
</div>

<h2>Service Request Scanner</h2>

<div id="reader"></div>
<div id="assetCard" class="card" style="display:none;"></div>

<script src="https://unpkg.com/html5-qrcode"></script>

<script>
/* ==============================
   ðŸ”— YOUR APPS SCRIPT URL
============================== */
const SCRIPT_URL =
https://script.google.com/macros/s/AKfycby-eT20zHfUAXSiUKhFnVszn-gxy1CcMb_Ek6ukKUgGBbPQkYSQ8Nlw4q0UTSArm8jxiw/exec;

/* ==============================
   ELEMENT
============================== */
const assetCard = document.getElementById("assetCard");

/* ==============================
   SHOW ASSET
============================== */
function showAsset(dept, asset) {

  let deptName = "";
  if (dept === "BIO") deptName = "Biomedical";
  if (dept === "IT")  deptName = "IT";
  if (dept === "MT")  deptName = "Maintenance";

  assetCard.innerHTML = `
    <div class="row"><div class="label">Department</div><div class="colon">:</div><div class="value">${deptName}</div></div>
    <div class="row"><div class="label">Asset ID</div><div class="colon">:</div><div class="value">${asset}</div></div>

    <hr>

    <button class="btn"
      onclick="window.open(
        '${SCRIPT_URL}?page=complaint&asset=${asset}&dept=${dept}',
        '_blank'
      )">
      Report Breakdown
    </button>

    <button class="btn"
      onclick="window.open(
        '${SCRIPT_URL}?page=close&asset=${asset}&dept=${dept}',
        '_blank'
      )">
      Close Breakdown
    </button>
  `;

  assetCard.style.display = "block";
}

/* ==============================
   QR SCANNER
============================== */
const qr = new Html5Qrcode("reader");

Html5Qrcode.getCameras().then(cams => {
  const cam = cams.find(c => c.label.toLowerCase().includes("back")) || cams[0];

  qr.start(
    cam.id,
    { fps: 15, qrbox: { width: 280, height: 280 } },
    text => {

      qr.stop();

      // ðŸ”¥ SPLIT QR DATA
      const parts = text.trim().split("|");

      if (parts.length !== 2) {
        alert("Invalid QR Code");
        return;
      }

      const dept  = parts[0];   // BIO / IT / MT
      const asset = parts[1];   // Asset ID

      showAsset(dept, asset);
    }
  );
});
</script>

</body>
</html>
